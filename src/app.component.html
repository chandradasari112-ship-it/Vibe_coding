<!-- Main Background Container -->
<div class="min-h-screen bg-gradient-to-br from-green-200 via-blue-300 to-yellow-200 p-4 sm:p-6 lg:p-8 font-sans">
  
  <!-- Main Content Card -->
  <main class="max-w-4xl mx-auto bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-6 sm:p-8 space-y-8">
    
    <!-- Header -->
    <header class="text-center">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Interest Calculator</h1>
      <p class="text-gray-600 mt-2">A simple tool for village students to learn about finance.</p>
    </header>

    <!-- Calculator Form -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
      
      <!-- Principal Amount -->
      <div class="space-y-2 relative">
        <label for="principal" class="flex items-center text-lg font-semibold text-gray-700">
          Principal Amount (â‚¹)
          <button (mouseenter)="showTooltip('principal')" (mouseleave)="hideTooltip()" class="ml-2 text-gray-500 hover:text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
          </button>
        </label>
        <input id="principal" type="number" [value]="principal() || ''" (input)="onPrincipalChange($event)" placeholder="e.g., 10000" class="w-full text-xl p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
      </div>

      <!-- Annual Interest Rate -->
      <div class="space-y-2 relative">
        <label for="rate" class="flex items-center text-lg font-semibold text-gray-700">
          Annual Rate (%)
          <button (mouseenter)="showTooltip('rate')" (mouseleave)="hideTooltip()" class="ml-2 text-gray-500 hover:text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
          </button>
        </label>
        <input id="rate" type="number" [value]="rate() || ''" (input)="onRateChange($event)" placeholder="e.g., 5" class="w-full text-xl p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
      </div>
      
      <!-- Time Period -->
      <div class="space-y-2 relative">
        <label for="time" class="flex items-center text-lg font-semibold text-gray-700">
          Time Period
           <button (mouseenter)="showTooltip('time')" (mouseleave)="hideTooltip()" class="ml-2 text-gray-500 hover:text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
          </button>
        </label>
        <div class="flex items-center space-x-2">
          <input id="time" type="number" [value]="time() || ''" (input)="onTimeChange($event)" placeholder="e.g., 10" class="w-full text-xl p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
          <button (click)="toggleTimeUnit()" class="px-4 py-3 text-lg font-medium rounded-lg transition-colors duration-200" [class]="timeUnit() === 'years' ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'">Years</button>
          <button (click)="toggleTimeUnit()" class="px-4 py-3 text-lg font-medium rounded-lg transition-colors duration-200" [class]="timeUnit() === 'months' ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'">Months</button>
        </div>
      </div>

      <!-- Compounding Frequency -->
      <div class="space-y-2 relative">
        <label for="frequency" class="flex items-center text-lg font-semibold text-gray-700">
          Interest Type
           <button (mouseenter)="showTooltip('compounding')" (mouseleave)="hideTooltip()" class="ml-2 text-gray-500 hover:text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
          </button>
        </label>
        <select id="frequency" [value]="compoundFrequency()" (change)="onFrequencyChange($event)" class="w-full text-xl p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition bg-white">
          <option value="0">Simple</option>
          <option value="12">Compound Monthly</option>
          <option value="4">Compound Quarterly</option>
          <option value="1">Compound Annually</option>
        </select>
      </div>

      <!-- Tooltip Display -->
      @if (tooltipContent(); as content) {
        <div class="md:col-span-2 p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg text-center text-md">
          {{ content }}
        </div>
      }
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 pt-4">
      <button (click)="calculate()" [disabled]="isLoading()" class="w-full sm:w-auto text-xl font-bold text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 rounded-lg px-12 py-4 transition-transform transform hover:scale-105">
        @if(isLoading()) {
          <span>Calculating...</span>
        } @else {
          <span>Calculate</span>
        }
      </button>
      <button (click)="reset()" class="w-full sm:w-auto text-xl font-bold text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg px-12 py-4 transition">Reset</button>
    </div>
    
    <!-- Progress Bar -->
    @if (isLoading()) {
      <div class="w-full bg-gray-200 rounded-full h-4">
        <div class="bg-green-500 h-4 rounded-full animate-pulse" style="width: 100%"></div>
      </div>
    }

    <!-- Results Section -->
    @if (calculationResult(); as result) {
      <section class="space-y-6 pt-6 border-t border-gray-200">
        <h2 class="text-2xl font-bold text-center text-gray-800">Calculation Results</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
          <!-- Simple Interest Card -->
          <div class="bg-blue-50 p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-blue-800">Simple Interest</h3>
            <p class="text-3xl font-bold text-blue-900 mt-2">{{ formatCurrency(result.totalSimple) }}</p>
            <p class="text-md text-blue-700 mt-1">Total Amount</p>
            <p class="text-lg text-gray-600 mt-4">Interest Earned: <span class="font-semibold">{{ formatCurrency(result.simpleInterest) }}</span></p>
          </div>
          
          <!-- Compound Interest Card -->
          <div class="bg-green-50 p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-green-800">Compound Interest</h3>
            <p class="text-3xl font-bold text-green-900 mt-2">{{ formatCurrency(result.compoundDetail.total) }}</p>
            <p class="text-md text-green-700 mt-1">Total Amount</p>
            <p class="text-lg text-gray-600 mt-4">Interest Earned: <span class="font-semibold">{{ formatCurrency(result.compoundDetail.interest) }}</span></p>
          </div>
        </div>

        <div class="text-center pt-4">
          <h3 class="text-xl font-semibold text-gray-700">Difference in Interest Earned</h3>
          <p class="text-4xl font-bold text-emerald-600 mt-2">{{ formatCurrency(result.compoundDetail.interest - result.simpleInterest) }}</p>
        </div>

        <div class="flex justify-center pt-4">
          <button (click)="exportToPdf()" class="flex items-center gap-2 text-lg font-bold text-white bg-red-500 hover:bg-red-600 rounded-lg px-8 py-3 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
            Export as PDF
          </button>
        </div>
      </section>
    }
  </main>
  
  <!-- History Section -->
  @if (calculationHistory().length > 0) {
    <section class="max-w-4xl mx-auto bg-white/60 backdrop-blur-sm rounded-2xl shadow-xl p-6 sm:p-8 mt-8">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-gray-800">Calculation History</h2>
        <button (click)="clearHistory()" class="text-sm font-medium text-red-600 hover:text-red-800">Clear History</button>
      </div>
      <div class="space-y-4 max-h-80 overflow-y-auto pr-2">
        @for (item of calculationHistory(); track item.timestamp) {
          <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 grid grid-cols-2 sm:grid-cols-4 gap-4 items-center">
            <div>
              <div class="text-xs text-gray-500">Principal</div>
              <div class="font-semibold text-gray-800">{{ formatCurrency(item.principal) }}</div>
            </div>
             <div>
              <div class="text-xs text-gray-500">Rate / Time</div>
              <div class="font-semibold text-gray-800">{{ item.rate }}% / {{ item.time }} {{ item.timeUnit.slice(0, -1) }}s</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Simple Total</div>
              <div class="font-semibold text-blue-700">{{ formatCurrency(item.totalSimple) }}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Compound Total</div>
              <div class="font-semibold text-green-700">{{ formatCurrency(item.compoundDetail.total) }}</div>
            </div>
          </div>
        }
      </div>
    </section>
  }
</div>
